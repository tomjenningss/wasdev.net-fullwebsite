<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />
<title>
MongoDB Replication Sample | IBM WebSphere Liberty Repository | WASdev
</title>
<link href="css/marketplace.css%3F_1416284010" rel="stylesheet" type="text/css">
<link rel="schema.DC" href="http://purl.org/DC/elements/1.0/"/>
<link rel="shortcut icon" href="../../../../wp-content/themes/projectnext/css/favicon.ico" />
<meta name="DC.Rights" content="? Copyright IBM Corporation 2016"/>
<meta name="Keywords" content="IBM WebSphere Liberty Repository, IBM Marketplace, wasdev, wasdev community, WebSphere Application Server, download, JazzHub "/>
<meta name="DC.Date" scheme="iso8601" content="2016-10-25"/>
<meta name="Source"  content="developerWorks"/>
<meta name="Security" content="Public"/>
<meta name="Abstract" content="The following sample demonstrates the Liberty Extended Profile's ability to configure and connect to a distributed set of MongoDB instances and insert data into the database's primary instance and read data from the database's primary and secondary instances ."/>
<meta name="Description" content="The following sample demonstrates the Liberty Extended Profile's ability to configure and connect to a distributed set of MongoDB instances and insert data into the database's primary instance and read data from the database's primary and secondary instances ."/>
<meta name="IBM.Effective" scheme="W3CDTF" content="2016-10-25"/>
<meta name="Owner" content="developerWorks Content/Raleigh/IBM"/>
<meta name="DC.Language" scheme="rfc1766" content="en"/>
<meta name="IBM.SpecialPurpose" content="SP001"/>
<meta name="IBM.Country" content="ZZ"/>
<meta name="Robots" content="index,follow"/>
<meta name="DC.Type" scheme="IBM_ContentClassTaxonomy" content="CT801" />
<meta name="DC.Subject" scheme="IBM_SubjectTaxonomy" content="ZZ999" />
<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
</head>

<body>
<div id="eLoader"></div>
<div id="eMain">
<h1>MongoDB Replication Sample</h1>
<div id="description">
<div id="ibm-wasdev-sample-desc-content"> 
 <p>This sample contains a server definition that includes the MongoDB, JNDI, and Servlet features. The application, mongoDBReplicationApp.war, uses the Liberty Extended Profile's ability to configure and connect to a distributed set of MongoDB instances and read from the primary and secondary instances. The DB object is accessed using JNDI lookup in the following code:</p> 
 <blockquote> 
  <code> @WebServlet(&quot;/&quot;)<br /> public class MongoReplicationServlet extends HttpServlet {<br /> protected DB db;<br /> db = (DB) new InitialContext().lookup(&quot;java:comp/env/mongo/studentdb&quot;);<br /> ...<br /> }<br /> </code> 
 </blockquote> 
 <p> <b>This sample assumes that a MongoDB replicaset is configured and MongoDB instances are running on <code>localhost:27017,localhost:27018,localhost:27019</code> .</b> </p> 
 <p id="ibm-wasdev-supported-runtime-content"> This sample can be installed onto runtime versions 8.5.5.0 and later. </p> 
</div> 
<h2 id="ibm-wasdev-sample-installation-title">Installation Instructions</h2> 
<div id="ibm-wasdev-sample-installation-content"> 
 <p>Online installation (requires 8.5.5.6 or later):</p> 
 <ol> 
  <li>Install the sample by running the command below from the bin directory of your server installation: <pre>installUtility install mongoDBReplicationSample</pre> </li> 
 </ol> 
 <p> Any missing features required by the server will be installed for you. </p> 
 <p>Offline installation:</p> 
 <ol> 
  <li>Download the <code>mongoDBReplicationSample.jar</code> using the download button at the top of the page and place it in the root of your server installation. </li> 
  <li>Extract the sample into the Liberty installation by running the command below from the root of your server installation: <pre>java -jar mongoDBReplicationSample.jar</pre> </li> 
 </ol> 
 <p> Any missing features required by the server will need to be installed separately. </p> 
</div> 
<h2 id="ibm-wasdev-sample-instructions-title">Running The Application</h2> 
<div id="ibm-wasdev-sample-instructions-content"> 
 <p>To run the MongoDBReplication application:</p> 
 <ol> 
  <li>Ensure that the MongoDB instances are running on <code>localhost:27017,localhost:27018,localhost:27019</code> or update the <code>server.xml</code> file to point to your MongoDB instance see <a href="MongoDB-Replication-Sample.html#ibm-wasdev-sample-notes-title">notes</a> for more infomation on doing this. </li> 
  <li>Start the mongoDBReplicationSample server by running the command below from the <code>bin</code> directory in the Liberty profile installation: <pre>server run mongoDBReplicationSample</pre> </li> 
  <li>Confirm the application started by looking for the following message in the log: <pre>CWWKZ0001I: Application mongoDBReplicationApp started in XX.XX seconds.</pre> </li> 
  <li>In your browser, enter the URL for the application: <a href="http://localhost:9140/mongoDBReplicationApp">http://localhost:9140/mongoDBReplicationApp</a> (where port 9140 assumes the httpEndpoint provided in the sample server.xml has not been modified). </li> 
  <li>The <code>com.mongodb.DB</code> resource lookup is successful if you see the following message:<br /> <code>Mongo Replication Sample</code> </li> 
  <li>After Mongo Replication Sample is displayed, information about the MongoDB replicaset will be displayed and number of elements will also be inserted into the database and the contents of the database will be read from both the primary and secondary and displayed.If the ReplicaSet Name and ReplicaSet Master is null , invoke the sample application again to populate those fields. See <a href="MongoDB-Replication-Sample.html#ibm-wasdev-sample-notes-title">notes</a> for example output. </li> 
  <li>Stop the server using the command '<code>bin/server stop mongoDBReplicationSample</code>'.</li> 
 </ol> 
</div> 
<h2 id="ibm-wasdev-sample-notes-title">Notes</h2> 
<div id="ibm-wasdev-sample-notes-content"> 
 <p>Example output from a successful run :</p> 
 <h1>Mongo Replication Sample </h1> 
 <table border="1"> 
  <tbody>
   <tr> 
    <td>Server Address List</td> 
    <td> [localhost:27017, localhost:27018, localhost:27019] </td> 
   </tr> 
   <tr> 
    <td>ReplicaSet Name</td> 
    <td> rs0 </td> 
   </tr> 
   <tr> 
    <td>ReplicaSet Master</td> 
    <td>localhost:27019</td> 
   </tr> 
   <tr> 
    <td>Database Name</td> 
    <td>studentdb</td> 
   </tr> 
  </tbody>
 </table> 
 <table border="1"> 
  <tbody>
   <tr> 
    <td>DB read preference : primary </td> 
   </tr> 
   <tr> 
    <td>Server Used : localhost:27019</td> 
   </tr> 
   <tr> 
    <td>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;53494b4cee93ad59ec7e5485&quot;} , &quot;Name&quot; : &quot;Mark&quot; , &quot;RollNo&quot; : 1 , &quot;Result&quot; : &quot;PASS&quot; , &quot;Grade&quot; : &quot;B&quot;}</td> 
   </tr> 
   <tr> 
    <td>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;53494b4fee93ad59ec7e5486&quot;} , &quot;Name&quot; : &quot;Monica&quot; , &quot;RollNo&quot; : 2 , &quot;Result&quot; : &quot;PASS&quot; , &quot;Grade&quot; : &quot;B&quot;} </td> 
   </tr> 
   <tr> 
    <td>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;53494b4fee93ad59ec7e5487&quot;} , &quot;Name&quot; : &quot;Geetha&quot; , &quot;RollNo&quot; : 3 , &quot;Result&quot; : &quot;PASS&quot; , &quot;Grade&quot; : &quot;A&quot;}</td> 
   </tr> 
   <tr> 
    <td>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;53494b4fee93ad59ec7e5488&quot;} , &quot;Name&quot; : &quot;Susan&quot; , &quot;RollNo&quot; : 4 , &quot;Result&quot; : &quot;FAIL&quot; , &quot;Grade&quot; : &quot;E&quot;} </td> 
   </tr> 
   <tr> 
    <td>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;53494b74ee93fe9a252d28b2&quot;} , &quot;Name&quot; : &quot;Geetha&quot; , &quot;RollNo&quot; : 5 , &quot;Result&quot; : &quot;PASS&quot; , &quot;Grade&quot; : &quot;B&quot;} </td> 
   </tr> 
  </tbody>
 </table> 
 <table border="1"> 
  <tbody>
   <tr> 
    <td>DB read preference : secondary </td> 
   </tr> 
   <tr> 
    <td>Server Used : localhost:27017 </td> 
   </tr> 
   <tr> 
    <td>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;53494b4cee93ad59ec7e5485&quot;} , &quot;Name&quot; : &quot;Mark&quot; , &quot;RollNo&quot; : 1 , &quot;Result&quot; : &quot;PASS&quot; , &quot;Grade&quot; : &quot;B&quot;}</td> 
   </tr> 
   <tr> 
    <td>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;53494b4fee93ad59ec7e5486&quot;} , &quot;Name&quot; : &quot;Monica&quot; , &quot;RollNo&quot; : 2 , &quot;Result&quot; : &quot;PASS&quot; , &quot;Grade&quot; : &quot;B&quot;}</td> 
   </tr> 
   <tr> 
    <td>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;53494b4fee93ad59ec7e5487&quot;} , &quot;Name&quot; : &quot;Geetha&quot; , &quot;RollNo&quot; : 3 , &quot;Result&quot; : &quot;PASS&quot; , &quot;Grade&quot; : &quot;A&quot;}</td> 
   </tr> 
   <tr> 
    <td>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;53494b4fee93ad59ec7e5488&quot;} , &quot;Name&quot; : &quot;Susan&quot; , &quot;RollNo&quot; : 4 , &quot;Result&quot; : &quot;FAIL&quot; , &quot;Grade&quot; : &quot;E&quot;}</td> 
   </tr> 
   <tr> 
    <td>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;53494b74ee93fe9a252d28b2&quot;} , &quot;Name&quot; : &quot;Geetha&quot; , &quot;RollNo&quot; : 5 , &quot;Result&quot; : &quot;PASS&quot; , &quot;Grade&quot; : &quot;B&quot;}</td> 
   </tr> 
  </tbody>
 </table> 
 <p>* If the ReplicaSet is not available, ReplicaSet Name and ReplicaSet Master information is not displayed </p> 
 <p>Troubleshooting :</p> 
 <ul> 
  <li>If your replicaset has MongoDB instance running somewhere other than the default <code>localhost:27017</code>, you can change the location via the <code>mongo</code> configuration element in the server.xml file.</li> 
  <li>If you see Mongo Replication Sample , but there isn't a following information about the replicaset, check the server SystemOut.log. If there is no mongoDB process running at localhost:27017, you should see the following warning : <pre>'[WARNING ] Server seen down: localhost/127.0.0.1:27017 - java.io.IOException - message: Connection refused: connect'.</pre> The solution to this problem is to start a MongoDB process at the default port on the local machine.</li> 
  <li>If you get a 404 response when you access the sample application and you see a <code>SRVE0187E</code> message, you most likely have a problem with your shared library. Ensure that the library element in the <code>server.xml</code> points to a valid Mongo Java Driver jar file.</li> 
 </ul> 
</div> 
<h2 id="ibm-wasdev-sample-stucture-title">Sample Structure</h2> 
<div id="ibm-wasdev-sample-structure-content"> 
 <ul class="structureitem"> 
  <li class="directory" title="">wlp</li> 
  <ul class="structureitem"> 
   <li class="directory" title="">usr</li> 
   <ul class="structureitem"> 
    <li class="directory" title="">servers</li> 
    <ul class="structureitem"> 
     <li class="directory" title="">mongoDBReplicationSample</li> 
     <ul class="structureitem"> 
      <li class="file" title="File: Included in Archive">Copyright.txt</li> 
      <li class="directory" title="">apps</li> 
      <ul class="structureitem"> 
       <li class="file" title="File: Included in Archive">mongoDBReplicationApp.war</li> 
      </ul> 
      <li class="directory" title="">lafiles</li> 
      <ul class="structureitem"> 
       <li class="file" title="File: Included in Archive">LA_en</li> 
       <li class="file" title="File: Included in Archive">LI_en</li> 
      </ul> 
      <li class="file" title="File: Included in Archive">readme.html</li> 
      <li class="file" title="File: Included in Archive">server.xml</li> 
     </ul> 
    </ul> 
    <li class="directory" title="">shared</li> 
    <ul class="structureitem"> 
     <li class="directory" title="">resources</li> 
     <ul class="structureitem"> 
      <li class="directory" title="">MongoDBReplicationSampleLibs</li> 
      <ul class="structureitem"> 
       <li class="external" title="External Dependency: http://central.maven.org/maven2/org/mongodb/mongo-java-driver/2.12.0/mongo-java-driver-2.12.0.jar">mongo-java-driver-2.12.0.jar</li> 
      </ul> 
     </ul> 
    </ul> 
   </ul> 
  </ul> 
 </ul> 
</div>
</div>
</div>
<div style="display:none">
<script>$( document ).ready(function() {
	$('#eLoader').height($(window).height());
    setTimeout(function(){
		location.href='https://developer.ibm.com/wasdev/downloads/#asset/samples-MongoDB_Replication_Sample';
	},100);
});
</script>
</div>
</body>

</html>
