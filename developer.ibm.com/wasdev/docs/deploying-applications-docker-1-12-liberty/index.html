<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Containerizing microservices</title><meta name="description" content="A tutorial on how to containerize or dockerize and run your Java microservices in Docker containers"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"><link rel="icon" type="image/x-icon" href="https://openliberty.io/favicon.ico"><link type="text/css" rel="stylesheet" href="https://openliberty.io/assets/openliberty-417cdd85f6072483030360356f930c017bd4dcc1f64ab74a65569803624b1b95.css"><link type="text/css" rel="stylesheet" href="https://openliberty.io/assets/coderay-custom-ab54124e3170f1f31f9b8fdd361c302b78a5238d19a86f6c6f34c4688e2e8d35.css"><link type="text/css" rel="stylesheet" href="https://openliberty.io/assets/doc-header-c309828408a64fdb82836c8eaf45589dd3f0470483d903e0bc55c6abaf963889.css"><link type="text/css" rel="stylesheet" href="https://openliberty.io/assets/toc-a0b9110a3e9da7f42eb13f4ba8d64a205bbc2f3f406cb0d504af6fc79ea8f859.css"><link type="text/css" rel="stylesheet" href="https://openliberty.io/assets/end-of-guide-78aa63e591c3ad3c94c61dfb23e1b0c417aab50a64d4e17b0062aab22a17137e.css"><link type="text/css" rel="stylesheet" href="https://openliberty.io/assets/guide-card-e0f001e61d331b9f363725e180d548fafef865e09c5806c90c25ae6c73b7f361.css"><link type="text/css" rel="stylesheet" href="https://openliberty.io/assets/guide-4de01bc72769767a332497a26743e5a2b7324eae873bb57bdc7a6fe6b1b8a889.css"><link type="text/css" rel="stylesheet" href="https://openliberty.io/assets/guide-multipane-6e79e71c68e01ccfcd4021fc6ba6a7c0137c6929e87aadb566929234592bca19.css"> <script>!function(e,t,a,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a),s="dataLayer"!=n?"&l="+n:"";m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id="+r+s,g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer","GTM-TKP3KJ7")</script><link rel="canonical" href="https://openliberty.io/guides/containerize"><link rel="alternate" type="application/rss+xml" title="Open Liberty" href="https://openliberty.io/feed.xml"><link href="https://fonts.googleapis.com/css?family=Asap:400,500" rel="stylesheet"><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@OpenLibertyIO"/><meta name="twitter:title" content="Containerizing microservices"/><meta name="twitter:description" content="A tutorial on how to containerize or dockerize and run your Java microservices in Docker containers"/><meta name="twitter:image" content="https://openliberty.io/img/twitter_card.jpg"/><meta name="google-site-verification" content="h2P030H9b66CyL1nEmWfrZB8Fr14h9LmVMG7Ur0caBs"/><script async defer src="https://buttons.github.io/buttons.js"></script></head><body> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TKP3KJ7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header> <nav class="navbar navbar-default"><div class="container-fluid"><div class="navbar-header"> <button id="navbar_responsive_button" class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a href="https://openliberty.io/" aria-label="Open Liberty Home Page"> <img id="doc_logo" src="https://openliberty.io/img/docs_openliberty_logo.png" class="img-responsive" alt="Home"> </a><div id="doc_title"> <img src="https://openliberty.io/img/doc_header_title.svg" alt="Docs"></div></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-left"><li> <a href="https://openliberty.io/guides">Guides</a></li><li id="reference_dropdown_container" class="btn-group"> <button type="button" class="btn btn-default dropdown-toggle reference_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> Reference <span id="reference_caret" class="hidden-md hidden-lg"></span> </button><ul class="dropdown-menu"><li><a href="https://openliberty.io/docs/ref/javaee/">Java EE API</a></li><li><a href="https://openliberty.io/docs/ref/microprofile/">MicroProfile API</a></li><li><a href="https://openliberty.io/docs/ref/config/">Server Config</a></li><li><a href="https://openliberty.io/docs/ref/feature/">Server Features</a></li><li><a href="https://openliberty.io/docs/ref/command/">Server Commands</a></li><li><a href="https://openliberty.io/docs/ref/general/">General</a></li></ul></li></ul><div id="header_round_links_container" class="visible-xs"> <a id="header_twitter_link" class="header_round_btn" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a> <a id="header_stackoverflow_link" class="header_round_btn" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a> <a id="header_groupsio_link" class="header_round_btn" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a></div></div><div id="breadcrumb_row"> <button id="breadcrumb_hamburger" class="toc-toggle collapsed" type="button" data-toggle="collapse" data-target="#toc_column" aria-expanded="false" aria-controls="toc_column"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> <img src="https://openliberty.io/img/toc_close_green.svg" id="header_close_toc_svg" class="hidden img-responsive" alt="Table of contents close button"> </button><ol class="breadcrumb fluid-container"><li> <a href="https://openliberty.io/docs">Docs</a></li><li> <a href="https://openliberty.io/guides">Guides</a></li><li class="active">Containerizing microservices</li></ol></div></div> </nav><div id="header_background"></div><div class="hidden"> <img src="https://openliberty.io/img/small_logo_white.svg"> <img src="https://openliberty.io/img/github_navbar_hover.svg"></div> </header><main aria-label="Content"><div id="background_container"><div id="toc_hotspot"></div><div id="toc_column" class="collapse inline open"><div id="toc_inner"><div id="close_container"> <img id="toc_close_white" src="https://openliberty.io/img/toc_close_white.svg" alt="Close the table of contents" tabindex="0"></div><div id="mobile_close_container" data-toggle="collapse" data-target="#toc_column" aria-expanded="false" aria-controls="toc_column"> <img src="https://openliberty.io/img/toc_close_green.svg" alt="Table of contents close button" tabindex="0"></div><h3 id="toc_title">Contents</h3><div id="toc_container"><ul class="sectlevel1"><li><a href="index.html#what-youll-learn">What you’ll learn</a></li><li><a href="index.html#getting-started">Getting started</a></li><li><a href="index.html#packaging-your-microservices">Packaging your microservices</a></li><li> <a href="index.html#building-your-docker-images">Building your Docker images</a><ul class="sectlevel2"><li><a href="index.html#creating-your-dockerfiles">Creating your Dockerfiles</a></li><li><a href="index.html#building-your-docker-image">Building your Docker image</a></li></ul></li><li><a href="index.html#running-your-microservices-in-docker-containers">Running your microservices in Docker containers</a></li><li> <a href="index.html#testing-the-microservices">Testing the microservices</a><ul class="sectlevel2"><li><a href="index.html#running-the-tests">Running the tests</a></li></ul></li><li><a href="index.html#great-work-youre-done">Great work! You’re done!</a></li><li><a href="index.html#guide-attribution">Guide Attribution</a></li></ul></div><div id="toc_separator"></div><h3 id="tag_title">Tags</h3><div id="tags_container"> <a href="https://openliberty.io/guides?search=Docker&amp;key=tag">Docker</a></div></div></div><div id="toc_indicator" tabindex="0" aria-label="Open the table of contents" class="hidden"> <img src="https://openliberty.io/img/arrow_white.svg" alt="arrow"></div><div id="toc_line" class="open"></div><div id="guide_column" class="position_relative open"><div id="guide_content"><div id="guide_meta" class="sect1" tabindex="0"><h1 id="guide_title">Containerizing microservices</h1><div id="duration_container"> <img src="https://openliberty.io/img/guide_duration_clock_icon_large.svg" alt="duration"> <span id="guide_duration">15 minutes</span></div><div id="mobile_prereqs_section"><p id="mobile_prereqs_title">Prerequisites:</p><div class="prereqs_list"></div></div></div><div class="scroller_anchor"></div><div id="mobile_toc_accordion_container" data-toggle="collapse" data-target="#toc_column" aria-expanded="false" aria-controls="toc_column"><div id="mobile_toc_accordion"> <button class="breadcrumb_hamburger toc-toggle collapsed" type="button" tabindex="0"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> <img src="https://openliberty.io/img/toc_close_green.svg" class="TOC_Close_SVG hidden img-responsive" alt="Table of contents close button"> </button> <span>Table of contents</span></div></div><div id="preamble"><div class="sectionbody"><div class="admonitionblock note hidden"><table><tr><td class="icon"> <i class="fa icon-note" title="Note"></i></td><td class="content"> This repository contains the guide documentation source. To view the guide in published form, view it on the <a href="index.html">Open Liberty website</a>.</td></tr></table></div><div class="paragraph"><p>Learn how to containerize and run your microservices with Open Liberty using Docker.</p></div></div></div><div class="sect1"><h2 id="what-youll-learn">What you’ll learn</h2><div class="sectionbody"><div class="paragraph"><p>You can easily deploy your microservices in different environments in a lightweight and portable manner by using containers. From development to production and across your DevOps environments, you can deploy your microservices consistently and efficiently with containers. You can run a container from a container image. Each container image is a package of what you need to run your microservice or application, from the code to its dependencies and configuration.</p></div><div class="paragraph"><p>You’ll learn how to build container images and run containers using Docker for your microservices. You’ll construct <code>Dockerfile</code> files, create Docker images by using the <code>docker build</code> command, and run the image as Docker containers by using <code>docker run</code> command.</p></div><div class="paragraph"><p>The two microservices that you’ll be working with are called <code>system</code> and <code>inventory</code>. The <code>system</code> microservice returns the JVM system properties of the running container. The <code>inventory</code> microservice adds the properties from the <code>system</code> microservice to the inventory. This guide demonstrates how both microservices can run and communicate with each other in different Docker containers.</p></div></div></div><div class="sect1 command"><h2 id="getting-started">Getting started</h2><div class="sectionbody"><div class="paragraph"><p>The fastest way to work through this guide is to clone the Git repository and use the projects that are provided inside:</p></div><div class="listingblock command"><div class="content"> <pre class="CodeRay highlight"><code>git clone https://github.com/openliberty/guide-containerize.git
cd guide-containerize</code></pre></div></div><div class="paragraph"><p>The <code>start</code> directory contains the starting project that you will build upon.</p></div><div class="paragraph"><p>The <code>finish</code> directory contains the finished project that you will build.</p></div></div></div><div class="sect1"><h2 id="packaging-your-microservices">Packaging your microservices</h2><div class="sectionbody"><div class="paragraph"><p>Navigate to the <code>start</code> directory to begin. You can find the starting Java project in the <code>start</code> directory. It is a multi-module Maven project that is made up of the <code>system</code> and <code>inventory</code> microservices. Each microservice lives in its own corresponding directory, <code>system</code> and <code>inventory</code>.</p></div><div class="paragraph"><p>To try out the application by using Maven, run the following Maven goals to build the application and run it inside Open Liberty:</p></div><div class="listingblock command"><div class="content"> <pre class="CodeRay highlight"><code>mvn install
mvn liberty:start-server</code></pre></div></div><div class="paragraph"><p>Notice that the <code class="hotspot=packageFile">&lt;packageFile&gt;</code> tag in the <code class="hotspot">pom.xml</code> file configures the microservices to be packaged in an archive form. The <code>system</code> and <code>inventory</code> microservices including the application <code>WAR</code> and server configuration files are archived into <code>system/target/system.tar.gz</code> and <code>inventory/target/inventory.tar.gz</code>.</p></div><div class="paragraph"><p>To access the <code>inventory</code> service, which displays the current contents of the inventory, see <a href="http://localhost:9081/inventory/systems" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9081/inventory/systems</a>.</p></div><div class="paragraph"><p>The <code>system</code> service shows the system properties of the running JVM and can be found at <a href="http://localhost:9080/system/properties" class="notranslate bare" target="_blank" rel="noopener noreferrer">http://localhost:9080/system/properties</a>.</p></div><div class="paragraph"><p>The system properties of your localhost can be added to the <code>inventory</code> at <a href="http://localhost:9081/inventory/systems/localhost" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9081/inventory/systems/localhost</a>.</p></div><div class="paragraph"><p>After you are done checking out the application, stop the Open Liberty server:</p></div><div class="listingblock command"><div class="content"> <pre class="CodeRay highlight"><code>mvn liberty:stop-server</code></pre></div></div><div class="paragraph"><p>pom.xml</p></div><div class="listingblock code_column"><div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="line-numbers">  1</span><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="tag">&lt;project</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">"</span></span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">"</span></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="line-numbers">  2</span>    <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>
<span class="line-numbers">  3</span>
<span class="line-numbers">  4</span>    <span class="tag">&lt;parent&gt;</span>
<span class="line-numbers">  5</span>        <span class="tag">&lt;groupId&gt;</span>net.wasdev.wlp.maven.parent<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">  6</span>        <span class="tag">&lt;artifactId&gt;</span>liberty-maven-app-parent<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">  7</span>        <span class="tag">&lt;version&gt;</span>RELEASE<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">  8</span>    <span class="tag">&lt;/parent&gt;</span>
<span class="line-numbers">  9</span>
<span class="line-numbers"> 10</span>    <span class="tag">&lt;groupId&gt;</span>io.openliberty.guides<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 11</span>    <span class="tag">&lt;artifactId&gt;</span>guide-containerize<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 12</span>    <span class="tag">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 13</span>    <span class="tag">&lt;packaging&gt;</span>pom<span class="tag">&lt;/packaging&gt;</span>
<span class="line-numbers"> 14</span>
<span class="line-numbers"> 15</span>    <span class="tag">&lt;properties&gt;</span>
<span class="line-numbers"> 16</span>        <span class="tag">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.build.sourceEncoding&gt;</span>
<span class="line-numbers"> 17</span>        <span class="tag">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.reporting.outputEncoding&gt;</span>
<span class="line-numbers"> 18</span>        <span class="tag">&lt;maven.compiler.source&gt;</span>1.8<span class="tag">&lt;/maven.compiler.source&gt;</span>
<span class="line-numbers"> 19</span>        <span class="tag">&lt;maven.compiler.target&gt;</span>1.8<span class="tag">&lt;/maven.compiler.target&gt;</span>
<span class="line-numbers"> 20</span>
<span class="line-numbers"> 21</span>        <span class="comment">&lt;!-- Plugins --&gt;</span>
<span class="line-numbers"> 22</span>        <span class="tag">&lt;version.maven-war-plugin&gt;</span>3.2.2<span class="tag">&lt;/version.maven-war-plugin&gt;</span>
<span class="line-numbers"> 23</span>        <span class="tag">&lt;version.download-maven-plugin&gt;</span>1.4.0<span class="tag">&lt;/version.download-maven-plugin&gt;</span>
<span class="line-numbers"> 24</span>        <span class="tag">&lt;version.maven-surefire-plugin&gt;</span>3.0.0-M1<span class="tag">&lt;/version.maven-surefire-plugin&gt;</span>
<span class="line-numbers"> 25</span>        <span class="tag">&lt;version.maven-failsafe-plugin&gt;</span>3.0.0-M1<span class="tag">&lt;/version.maven-failsafe-plugin&gt;</span>
<span class="line-numbers"> 26</span>        <span class="comment">&lt;!-- OpenLiberty runtime --&gt;</span>
<span class="line-numbers"> 27</span>        <span class="tag">&lt;version.openliberty-runtime&gt;</span>RELEASE<span class="tag">&lt;/version.openliberty-runtime&gt;</span>
<span class="line-numbers"> 28</span>        <span class="tag">&lt;sys.service.http.port&gt;</span>9080<span class="tag">&lt;/sys.service.http.port&gt;</span>
<span class="line-numbers"> 29</span>        <span class="tag">&lt;sys.service.https.port&gt;</span>9443<span class="tag">&lt;/sys.service.https.port&gt;</span>
<span class="line-numbers"> 30</span>        <span class="tag">&lt;inv.service.http.port&gt;</span>9081<span class="tag">&lt;/inv.service.http.port&gt;</span>
<span class="line-numbers"> 31</span>        <span class="tag">&lt;inv.service.https.port&gt;</span>9444<span class="tag">&lt;/inv.service.https.port&gt;</span>
<span class="line-numbers"> 32</span>    <span class="tag">&lt;/properties&gt;</span>
<span class="line-numbers"> 33</span>
<span class="line-numbers"> 34</span>    <span class="comment">&lt;!-- Shared dependencies. --&gt;</span>
<span class="line-numbers"> 35</span>    <span class="tag">&lt;dependencyManagement&gt;</span>
<span class="line-numbers"> 36</span>        <span class="tag">&lt;dependencies&gt;</span>
<span class="line-numbers"> 37</span>            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 38</span>                <span class="tag">&lt;groupId&gt;</span>io.openliberty.features<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 39</span>                <span class="tag">&lt;artifactId&gt;</span>features-bom<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 40</span>                <span class="tag">&lt;version&gt;</span>RELEASE<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 41</span>                <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
<span class="line-numbers"> 42</span>                <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 43</span>            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 44</span>            <span class="comment">&lt;!-- For tests --&gt;</span>
<span class="line-numbers"> 45</span>            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 46</span>                <span class="tag">&lt;groupId&gt;</span>junit<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 47</span>                <span class="tag">&lt;artifactId&gt;</span>junit<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 48</span>                <span class="tag">&lt;version&gt;</span>4.12<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 49</span>                <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 50</span>            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 51</span>            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 52</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.cxf<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 53</span>                <span class="tag">&lt;artifactId&gt;</span>cxf-rt-rs-client<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 54</span>                <span class="tag">&lt;version&gt;</span>3.2.6<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 55</span>                <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 56</span>            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 57</span>            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 58</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.cxf<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 59</span>                <span class="tag">&lt;artifactId&gt;</span>cxf-rt-rs-extension-providers<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 60</span>                <span class="tag">&lt;version&gt;</span>3.2.6<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 61</span>                <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 62</span>            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 63</span>            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 64</span>                <span class="tag">&lt;groupId&gt;</span>org.glassfish<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 65</span>                <span class="tag">&lt;artifactId&gt;</span>javax.json<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 66</span>                <span class="tag">&lt;version&gt;</span>1.0.4<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 67</span>                <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 68</span>            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 69</span>            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 70</span>                <span class="tag">&lt;groupId&gt;</span>org.apache.commons<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 71</span>                <span class="tag">&lt;artifactId&gt;</span>commons-lang3<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 72</span>                <span class="tag">&lt;version&gt;</span>3.0<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 73</span>                <span class="tag">&lt;scope&gt;</span>compile<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 74</span>            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 75</span>            <span class="comment">&lt;!-- Support for JDK 9 and above --&gt;</span>
<span class="line-numbers"> 76</span>            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 77</span>                <span class="tag">&lt;groupId&gt;</span>javax.xml.bind<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 78</span>                <span class="tag">&lt;artifactId&gt;</span>jaxb-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 79</span>                <span class="tag">&lt;version&gt;</span>2.3.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 80</span>                <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 81</span>            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 82</span>            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 83</span>                <span class="tag">&lt;groupId&gt;</span>com.sun.xml.bind<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 84</span>                <span class="tag">&lt;artifactId&gt;</span>jaxb-core<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 85</span>                <span class="tag">&lt;version&gt;</span>2.3.0.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 86</span>                <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 87</span>            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 88</span>            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 89</span>                <span class="tag">&lt;groupId&gt;</span>com.sun.xml.bind<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 90</span>                <span class="tag">&lt;artifactId&gt;</span>jaxb-impl<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 91</span>                <span class="tag">&lt;version&gt;</span>2.3.2<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 92</span>                <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 93</span>            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers"> 94</span>            <span class="tag">&lt;dependency&gt;</span>
<span class="line-numbers"> 95</span>                <span class="tag">&lt;groupId&gt;</span>javax.activation<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> 96</span>                <span class="tag">&lt;artifactId&gt;</span>activation<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> 97</span>                <span class="tag">&lt;version&gt;</span>1.1.1<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers"> 98</span>                <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="line-numbers"> 99</span>            <span class="tag">&lt;/dependency&gt;</span>
<span class="line-numbers">100</span>        <span class="tag">&lt;/dependencies&gt;</span>
<span class="line-numbers">101</span>    <span class="tag">&lt;/dependencyManagement&gt;</span>
<span class="line-numbers">102</span>
<span class="line-numbers">103</span>    <span class="tag">&lt;profiles&gt;</span>
<span class="line-numbers">104</span>        <span class="comment">&lt;!-- mvn.cmd for windows systems --&gt;</span>
<span class="line-numbers">105</span>        <span class="tag">&lt;profile&gt;</span>
<span class="line-numbers">106</span>            <span class="tag">&lt;id&gt;</span>windowsExtension<span class="tag">&lt;/id&gt;</span>
<span class="line-numbers">107</span>            <span class="tag">&lt;activation&gt;</span>
<span class="line-numbers">108</span>                <span class="tag">&lt;os&gt;</span><span class="tag">&lt;family&gt;</span>Windows<span class="tag">&lt;/family&gt;</span><span class="tag">&lt;/os&gt;</span>
<span class="line-numbers">109</span>            <span class="tag">&lt;/activation&gt;</span>
<span class="line-numbers">110</span>            <span class="tag">&lt;properties&gt;</span>
<span class="line-numbers">111</span>                <span class="tag">&lt;mvn.extension&gt;</span>.cmd<span class="tag">&lt;/mvn.extension&gt;</span>
<span class="line-numbers">112</span>            <span class="tag">&lt;/properties&gt;</span>
<span class="line-numbers">113</span>        <span class="tag">&lt;/profile&gt;</span>
<span class="line-numbers">114</span>        <span class="comment">&lt;!-- just mvn for other systems --&gt;</span>
<span class="line-numbers">115</span>        <span class="tag">&lt;profile&gt;</span>
<span class="line-numbers">116</span>            <span class="tag">&lt;id&gt;</span>nonWindowsExtension<span class="tag">&lt;/id&gt;</span>
<span class="line-numbers">117</span>            <span class="tag">&lt;activation&gt;</span>
<span class="line-numbers">118</span>                <span class="tag">&lt;os&gt;</span><span class="tag">&lt;family&gt;</span>!Windows<span class="tag">&lt;/family&gt;</span><span class="tag">&lt;/os&gt;</span>
<span class="line-numbers">119</span>            <span class="tag">&lt;/activation&gt;</span>
<span class="line-numbers">120</span>            <span class="tag">&lt;properties&gt;</span>
<span class="line-numbers">121</span>                <span class="tag">&lt;mvn.extension&gt;</span><span class="tag">&lt;/mvn.extension&gt;</span>
<span class="line-numbers">122</span>            <span class="tag">&lt;/properties&gt;</span>
<span class="line-numbers">123</span>        <span class="tag">&lt;/profile&gt;</span>
<span class="line-numbers">124</span>    <span class="tag">&lt;/profiles&gt;</span>
<span class="line-numbers">125</span>
<span class="line-numbers">126</span>    <span class="tag">&lt;build&gt;</span>
<span class="line-numbers">127</span>        <span class="tag">&lt;pluginManagement&gt;</span>
<span class="line-numbers">128</span>            <span class="tag">&lt;plugins&gt;</span>
<span class="line-numbers">129</span>                <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">130</span>                    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">131</span>                    <span class="tag">&lt;artifactId&gt;</span>maven-war-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">132</span>                    <span class="tag">&lt;version&gt;</span>${version.maven-war-plugin}<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">133</span>                    <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers">134</span>                        <span class="tag">&lt;failOnMissingWebXml&gt;</span>false<span class="tag">&lt;/failOnMissingWebXml&gt;</span>
<span class="line-numbers">135</span>                        <span class="tag">&lt;packagingExcludes&gt;</span>pom.xml<span class="tag">&lt;/packagingExcludes&gt;</span>
<span class="line-numbers">136</span>                    <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">137</span>                <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">138</span>                <span class="comment">&lt;!-- Liberty Maven plugin --&gt;</span>
<span class="line-numbers">139</span>                <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">140</span>                    <span class="tag">&lt;groupId&gt;</span>net.wasdev.wlp.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">141</span>                    <span class="tag">&lt;artifactId&gt;</span>liberty-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">142</span>                    <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers">143</span>                        <span class="tag">&lt;assemblyArtifact&gt;</span>
<span class="line-numbers">144</span>                            <span class="tag">&lt;groupId&gt;</span>io.openliberty<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">145</span>                            <span class="tag">&lt;artifactId&gt;</span>openliberty-runtime<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">146</span>                            <span class="tag">&lt;version&gt;</span>RELEASE<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">147</span>                            <span class="tag">&lt;type&gt;</span>zip<span class="tag">&lt;/type&gt;</span>
<span class="line-numbers">148</span>                        <span class="tag">&lt;/assemblyArtifact&gt;</span>
<span class="line-numbers">149</span>                        <span class="tag">&lt;skip&gt;</span>true<span class="tag">&lt;/skip&gt;</span>
<span class="line-numbers">150</span>                        <span class="comment">&lt;!-- tag::packageFile[] --&gt;</span>
<span class="line-numbers">151</span>                        <span class="tag">&lt;packageFile&gt;</span>
<span class="line-numbers">152</span>                            ${project.build.directory}/${app.name}.tar.gz
<span class="line-numbers">153</span>                        <span class="tag">&lt;/packageFile&gt;</span>
<span class="line-numbers">154</span>                        <span class="comment">&lt;!-- end::packageFile[] --&gt;</span>
<span class="line-numbers">155</span>                    <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">156</span>                <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">157</span>                <span class="comment">&lt;!-- Plugin to run unit tests --&gt;</span>
<span class="line-numbers">158</span>                <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">159</span>                    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">160</span>                    <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">161</span>                    <span class="tag">&lt;version&gt;</span>${version.maven-surefire-plugin}<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">162</span>                    <span class="tag">&lt;executions&gt;</span>
<span class="line-numbers">163</span>                        <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers">164</span>                            <span class="tag">&lt;phase&gt;</span>test<span class="tag">&lt;/phase&gt;</span>
<span class="line-numbers">165</span>                            <span class="tag">&lt;id&gt;</span>default-test<span class="tag">&lt;/id&gt;</span>
<span class="line-numbers">166</span>                            <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers">167</span>                                <span class="tag">&lt;excludes&gt;</span>
<span class="line-numbers">168</span>                                    <span class="tag">&lt;exclude&gt;</span>**/it/**<span class="tag">&lt;/exclude&gt;</span>
<span class="line-numbers">169</span>                                <span class="tag">&lt;/excludes&gt;</span>
<span class="line-numbers">170</span>                                <span class="tag">&lt;reportsDirectory&gt;</span>
<span class="line-numbers">171</span>                                    ${project.build.directory}/test-reports/unit
<span class="line-numbers">172</span>                                <span class="tag">&lt;/reportsDirectory&gt;</span>
<span class="line-numbers">173</span>                            <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">174</span>                        <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers">175</span>                    <span class="tag">&lt;/executions&gt;</span>
<span class="line-numbers">176</span>                <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">177</span>                <span class="comment">&lt;!-- Plugin to run functional tests --&gt;</span>
<span class="line-numbers">178</span>                <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers">179</span>                    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers">180</span>                    <span class="tag">&lt;artifactId&gt;</span>maven-failsafe-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers">181</span>                    <span class="tag">&lt;version&gt;</span>${version.maven-failsafe-plugin}<span class="tag">&lt;/version&gt;</span>
<span class="line-numbers">182</span>                    <span class="tag">&lt;executions&gt;</span>
<span class="line-numbers">183</span>                        <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers">184</span>                            <span class="tag">&lt;phase&gt;</span>integration-test<span class="tag">&lt;/phase&gt;</span>
<span class="line-numbers">185</span>                            <span class="tag">&lt;id&gt;</span>integration-test<span class="tag">&lt;/id&gt;</span>
<span class="line-numbers">186</span>                            <span class="tag">&lt;goals&gt;</span>
<span class="line-numbers">187</span>                                <span class="tag">&lt;goal&gt;</span>integration-test<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers">188</span>                            <span class="tag">&lt;/goals&gt;</span>
<span class="line-numbers">189</span>                            <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers">190</span>                                <span class="tag">&lt;includes&gt;</span>
<span class="line-numbers">191</span>                                    <span class="tag">&lt;include&gt;</span>**/it/**<span class="tag">&lt;/include&gt;</span>
<span class="line-numbers">192</span>                                <span class="tag">&lt;/includes&gt;</span>
<span class="line-numbers">193</span>                                <span class="tag">&lt;systemPropertyVariables&gt;</span>
<span class="line-numbers">194</span>                                    <span class="tag">&lt;system.ip&gt;</span>${system.ip}<span class="tag">&lt;/system.ip&gt;</span>
<span class="line-numbers">195</span>                                    <span class="tag">&lt;sys.http.port&gt;</span>
<span class="line-numbers">196</span>                                        ${sys.service.http.port}
<span class="line-numbers">197</span>                                    <span class="tag">&lt;/sys.http.port&gt;</span>
<span class="line-numbers">198</span>                                    <span class="tag">&lt;inv.http.port&gt;</span>
<span class="line-numbers">199</span>                                        ${inv.service.http.port}
<span class="line-numbers">200</span>                                    <span class="tag">&lt;/inv.http.port&gt;</span>
<span class="line-numbers">201</span>                                <span class="tag">&lt;/systemPropertyVariables&gt;</span>
<span class="line-numbers">202</span>                            <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">203</span>                        <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers">204</span>                        <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers">205</span>                            <span class="tag">&lt;id&gt;</span>verify-results<span class="tag">&lt;/id&gt;</span>
<span class="line-numbers">206</span>                            <span class="tag">&lt;goals&gt;</span>
<span class="line-numbers">207</span>                                <span class="tag">&lt;goal&gt;</span>verify<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers">208</span>                            <span class="tag">&lt;/goals&gt;</span>
<span class="line-numbers">209</span>                        <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers">210</span>                    <span class="tag">&lt;/executions&gt;</span>
<span class="line-numbers">211</span>                    <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers">212</span>                        <span class="tag">&lt;summaryFile&gt;</span>
<span class="line-numbers">213</span>                        ${project.build.directory}/test-reports/it/failsafe-summary.xml
<span class="line-numbers">214</span>                        <span class="tag">&lt;/summaryFile&gt;</span>
<span class="line-numbers">215</span>                        <span class="tag">&lt;reportsDirectory&gt;</span>
<span class="line-numbers">216</span>                            ${project.build.directory}/test-reports/it
<span class="line-numbers">217</span>                        <span class="tag">&lt;/reportsDirectory&gt;</span>
<span class="line-numbers">218</span>                    <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers">219</span>                <span class="tag">&lt;/plugin&gt;</span>
<span class="line-numbers">220</span>            <span class="tag">&lt;/plugins&gt;</span>
<span class="line-numbers">221</span>        <span class="tag">&lt;/pluginManagement&gt;</span>
<span class="line-numbers">222</span>    <span class="tag">&lt;/build&gt;</span>
<span class="line-numbers">223</span>
<span class="line-numbers">224</span>    <span class="tag">&lt;modules&gt;</span>
<span class="line-numbers">225</span>        <span class="tag">&lt;module&gt;</span>system<span class="tag">&lt;/module&gt;</span>
<span class="line-numbers">226</span>        <span class="tag">&lt;module&gt;</span>inventory<span class="tag">&lt;/module&gt;</span>
<span class="line-numbers">227</span>    <span class="tag">&lt;/modules&gt;</span>
<span class="line-numbers">228</span>
<span class="line-numbers">229</span><span class="tag">&lt;/project&gt;</span></code></pre></div></div><div class="paragraph"><p>To learn more about RESTful web services and how to build them, see <a href="https://openliberty.io/guides/rest-intro.html" target="_blank" rel="noopener">Creating a RESTful web service</a> for details about how to build the <code>system</code> service. The <code>inventory</code> service is built in a similar way.</p></div></div></div><div class="sect1"><h2 id="building-your-docker-images">Building your Docker images</h2><div class="sectionbody"><div class="paragraph"><p>A Docker image is a binary file. It is made up of multiple layers and is used to run code in a Docker container. Images are built from instructions in Dockerfiles to create a containerized version of the application.</p></div><div class="paragraph"><p>A <code>Dockerfile</code> is a collection of instructions for building a Docker image that can then be run as a container. As each instruction is run in a <code>Dockerfile</code>, a new Docker layer is created. These layers, which are known as intermediate images, are created when a change is made to your Docker image.</p></div><div class="paragraph"><p>Every <code>Dockerfile</code> begins with a parent or base image over which various commands are run. For example, you can start your image from scratch and run commands that download and install a Java runtime, or you can start from an image that already contains a Java installation.</p></div><div class="paragraph"><p>Learn more about Docker on the <a href="https://www.docker.com/what-docker" target="_blank" rel="noopener noreferrer">official Docker page</a>.</p></div><div class="paragraph"><p>Install Docker by following the instructions on the <a href="https://docs.docker.com/engine/installation" target="_blank" rel="noopener noreferrer">official page</a>.</p></div><div class="sect2"><h3 id="creating-your-dockerfiles">Creating your Dockerfiles</h3><div class="paragraph"><p>You will be creating two Docker images to run the <code>inventory</code> service and <code>system</code> service. The first step is to create Dockerfiles for both services.</p></div><div class="listingblock code_command hotspot file=0"><div class="content"> <pre><mark>Create the <code>Dockerfile</code> for the inventory service.</mark>
<code>inventory/Dockerfile</code></pre></div></div><div class="paragraph"><p>inventory/Dockerfile</p></div><div class="listingblock code_column"><div class="content"> <pre class="CodeRay highlight"><code data-lang="Text"><span class="line-numbers"> 1</span># tag::from[]
<span class="line-numbers"> 2</span>FROM open-liberty
<span class="line-numbers"> 3</span># end::from[]
<span class="line-numbers"> 4</span># tag::add[]
<span class="line-numbers"> 5</span># tag::userID[]
<span class="line-numbers"> 6</span>ADD --chown=1001:0 \
<span class="line-numbers"> 7</span># end::userID[]
<span class="line-numbers"> 8</span>    # tag::source[]
<span class="line-numbers"> 9</span>    target/inventory.tar.gz \
<span class="line-numbers">10</span>    # end::source[]
<span class="line-numbers">11</span>    # tag::destination[]
<span class="line-numbers">12</span>    /opt/ol
<span class="line-numbers">13</span>    # end::destination[]
<span class="line-numbers">14</span># end::add[]</code></pre></div></div><div class="paragraph"><p>The <code class="hotspot=from file=0">FROM</code> instruction initializes a new build stage, which indicates the parent image of the built image. If you don’t need a parent image, then you can use <code>FROM scratch</code>, which makes your image a base image.</p></div><div class="paragraph"><p>In this case, you’re using the <code>open-liberty</code> image as your parent image, which comes with the Open Liberty runtime by default. You can find all different official images at <a href="https://hub.docker.com/_/open-liberty" target="_blank" rel="noopener noreferrer">open-liberty Docker Hub</a>. To pull a different open-liberty image, like <code>kernel</code>, define the <code>FROM</code> instruction as <code>FROM open-liberty: kernel</code>.</p></div><div class="paragraph"><p>During the build, use a single <code>ADD</code> command instead of using multiple <code>COPY</code> commands to transfer configuration files and the application because the application is packaged into an archive. It eliminates multiple layers as the Docker image is created.</p></div><div class="paragraph"><p>The <code class="hotspot=add file=0">ADD</code> instruction is structured as <code class="hotspot=add file=0">ADD</code> <code class="hotspot=userID file=0">[--chown=&lt;user&gt;:&lt;group&gt;]</code> <code class="hotspot=source file=0">&lt;source&gt;</code> <code class="hotspot=destination file=0">&lt;destination&gt;</code>. It copies local files and directories into the specified destination within your Docker image. If the source is an archive, the <code class="hotspot=add file=0">ADD</code> instruction unpacks it into the destination directory. In this case, the <code>inventory</code> application archive <code class="hotspot=source file=0">inventory.tar.gz</code>, created from running <code>mvn install</code> previously, is extracted to the destination directory <code class="hotspot=destination file=0">/opt/ol</code>.</p></div><div class="paragraph"><p>The <code class="hotspot=add file=0">ADD</code> instruction needs to use the user ID <code class="hotspot=userID file=0">1001</code> and group <code class="hotspot=userID file=0">0</code> because the <code>open-liberty</code> image runs by default with the <code>USER 1001</code> (non-root) user for security purposes. Otherwise, the files and directories that are copied over are owned by the root user.</p></div><div class="paragraph"><p>The <code>Dockerfile</code> for the <code>system</code> service follows the same instructions as the <code>inventory</code> service, except that the <code class="hotspot=add file=1">system.tar.gz</code> archive is copied over into <code>/opt/ol</code>.</p></div><div class="listingblock code_command hotspot file=1"><div class="content"> <pre><mark>Create the <code>Dockerfile</code> for the system service.</mark>
<code>system/Dockerfile</code></pre></div></div><div class="paragraph"><p>system/Dockerfile</p></div><div class="listingblock code_column"><div class="content"> <pre class="CodeRay highlight"><code data-lang="Text"><span class="line-numbers">1</span>FROM open-liberty
<span class="line-numbers">2</span># tag::add[]
<span class="line-numbers">3</span>ADD --chown=1001:0 target/system.tar.gz /opt/ol
<span class="line-numbers">4</span># end::add[]</code></pre></div></div></div><div class="sect2"><h3 id="building-your-docker-image">Building your Docker image</h3><div class="paragraph"><p>Now that your microservices are packaged and you have written your Dockerfiles, you will build your Docker images by using the <code>docker build</code> command. To build your image, you need to have Docker installed and your Docker daemon started.</p></div><div class="paragraph"><p>Run the following commands to build container images for your application:</p></div><div class="listingblock command"><div class="content"> <pre class="CodeRay highlight"><code>docker build -t system:1.0-SNAPSHOT system/.
docker build -t inventory:1.0-SNAPSHOT inventory/.</code></pre></div></div><div class="paragraph"><p>The <code>-t</code> flag in the <code>docker build</code> command allows the Docker image to be labeled (tagged) in the <code>name[:tag]</code> format. The tag for an image describes the specific image version. If the optional <code>[:tag]</code> tag is not specified, the <code>latest</code> tag is created by default.</p></div><div class="paragraph"><p>To verify that the images are built, run the <code>docker images</code> command to list all local Docker images:</p></div><div class="listingblock command"><div class="content"> <pre class="CodeRay highlight"><code>docker images</code></pre></div></div><div class="paragraph"><p>Your two images, <code>inventory</code> and <code>system</code>, should appear in the list of all Docker images:</p></div><div class="listingblock no_copy"><div class="content"> <pre>REPOSITORY    TAG             IMAGE ID        CREATED          SIZE
inventory     1.0-SNAPSHOT    08fef024e986    4 minutes ago    471MB
system        1.0-SNAPSHOT    1dff6d0b4f31    5 minutes ago    470MB</pre></div></div></div></div></div><div class="sect1"><h2 id="running-your-microservices-in-docker-containers">Running your microservices in Docker containers</h2><div class="sectionbody"><div class="paragraph"><p>Now that you have your two images built, you will run your microservices in Docker containers:</p></div><div class="listingblock command"><div class="content"> <pre class="CodeRay highlight"><code>docker run -d --name system -p 9080:9080 system:1.0-SNAPSHOT
docker run -d --name inventory -p 9081:9081 inventory:1.0-SNAPSHOT</code></pre></div></div><div class="paragraph"><p>The flags are described in the table below:</p></div><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width:13.0434%"><col style="width:86.9566%"></colgroup><thead><tr><th class="tableblock halign-left valign-top"><strong>Flag</strong></th><th class="tableblock halign-left valign-top"><strong>Description</strong></th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">-d</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Runs the container in the background.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">--name</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a name for the container.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">-p</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Maps the host ports to the container ports. For example: <code>-p &lt;HOST_PORT&gt;:&lt;CONTAINER_PORT&gt;</code></p></td></tr></tbody></table><div class="paragraph"><p>Next, run the <code>docker ps</code> command to verify that your containers are started:</p></div><div class="listingblock command"><div class="content"> <pre class="CodeRay highlight"><code>docker ps</code></pre></div></div><div class="paragraph"><p>Make sure that your containers are running and show <code>Up</code> as their status:</p></div><div class="listingblock no_copy"><div class="content"> <pre>CONTAINER ID    IMAGE                   COMMAND                  CREATED          STATUS          PORTS                                        NAMES
2b584282e0f5    inventory:1.0-SNAPSHOT  "/opt/ol/helpers/run…"   2 seconds ago    Up 1 second     9080/tcp, 9443/tcp, 0.0.0.0:9081-&gt;9081/tcp   inventory
99a98313705f    system:1.0-SNAPSHOT     "/opt/ol/helpers/run…"   3 seconds ago    Up 2 seconds    0.0.0.0:9080-&gt;9080/tcp, 9443/tcp             system</pre></div></div><div class="paragraph"><p>If a problem occurs and your containers exit prematurely, the containers don’t appear in the container list that the <code>docker ps</code> command displays. Instead, your containers appear with an <code>Exited</code> status when they run the <code>docker ps -a</code> command. Run the <code>docker logs system</code> and <code>docker logs inventory</code> commands to view the container logs for any potential problems. Run the <code>docker stats system</code> and <code>docker stats inventory</code> commands to display a live stream of usage statistics for your containers. You can also double-check that your Dockerfiles are correct. When you find the cause of the issues, remove the faulty containers with the <code>docker rm system</code> and <code>docker rm inventory</code> commands. Rebuild your images, and start the containers again.</p></div><div class="paragraph"><p>To access the application, point your browser to the <a href="http://localhost:9081/inventory/systems" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9081/inventory/systems</a> URL. An empty list is expected because no system properties are stored in the inventory yet.</p></div><div class="paragraph"><p>Next, retrieve the <code>system</code> container’s IP address by using the <code>system</code> container’s name that is defined when it ran the Docker containers. Run the following command to retrieve the <code>system</code> IP address:</p></div><div class="listingblock command"><div class="content"> <pre class="CodeRay highlight"><code>docker inspect -f "{{.NetworkSettings.IPAddress }}" system</code></pre></div></div><div class="paragraph"><p>You find the <code>system</code> container’s IP address:</p></div><div class="listingblock no_copy"><div class="content"> <pre>172.17.0.2</pre></div></div><div class="paragraph"><p>In this case, the IP address for the <code>system</code> service is <code>172.17.0.2</code>. Take note of this IP address to add the system properties to the <code>inventory</code> service.</p></div><div class="paragraph"><p>Point your browser to <code>http://localhost:9081/inventory/systems/[system-ip-address]</code> by replacing <code>[system-ip-address]</code> with the IP address you obtained earlier. You see a result in JSON format with the system properties of your local JVM. When you visit this URL, these system properties are automatically stored in the inventory. Go back to <a href="http://localhost:9081/inventory/systems" target="_blank" rel="noopener noreferrer" class="notranslate">http://localhost:9081/inventory/systems</a> and you see a new entry for <code>[system-ip-address]</code>.</p></div></div></div><div class="sect1"><h2 id="testing-the-microservices">Testing the microservices</h2><div class="sectionbody"><div class="paragraph"><p>You can test your microservices manually by hitting the endpoints or with automated tests that check your running Docker containers.</p></div><div class="listingblock code_command hotspot file=0"><div class="content"> <pre><mark>Create the <code>SystemEndpointTest</code> class.</mark>
<code>system/src/test/java/it/io/openliberty/guides/system/SystemEndpointTest.java</code></pre></div></div><div class="paragraph"><p>SystemEndpointTest.java</p></div><div class="listingblock code_column hide_tags=copyright"><div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers"> 1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers"> 2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers"> 3</span><span class="comment"> * Copyright (c) 2018, 2019 IBM Corporation and others.</span>
<span class="line-numbers"> 4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers"> 5</span><span class="comment"> * are made available under the terms of the Eclipse Public License v1.0</span>
<span class="line-numbers"> 6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers"> 7</span><span class="comment"> * http://www.eclipse.org/legal/epl-v10.html</span>
<span class="line-numbers"> 8</span><span class="comment"> *</span>
<span class="line-numbers"> 9</span><span class="comment"> * Contributors:</span>
<span class="line-numbers">10</span><span class="comment"> *     IBM Corporation - Initial implementation</span>
<span class="line-numbers">11</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers">12</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers">13</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.system</span>;
<span class="line-numbers">14</span>
<span class="line-numbers">15</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertEquals</span>;
<span class="line-numbers">16</span>
<span class="line-numbers">17</span><span class="keyword">import</span> <span class="include">javax.net.ssl.HostnameVerifier</span>;
<span class="line-numbers">18</span><span class="keyword">import</span> <span class="include">javax.net.ssl.SSLSession</span>;
<span class="line-numbers">19</span><span class="keyword">import</span> <span class="include">javax.ws.rs.client.Client</span>;
<span class="line-numbers">20</span><span class="keyword">import</span> <span class="include">javax.ws.rs.client.ClientBuilder</span>;
<span class="line-numbers">21</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.Response</span>;
<span class="line-numbers">22</span>
<span class="line-numbers">23</span><span class="keyword">import</span> <span class="include">org.junit.After</span>;
<span class="line-numbers">24</span><span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="line-numbers">25</span><span class="keyword">import</span> <span class="include">org.junit.BeforeClass</span>;
<span class="line-numbers">26</span><span class="keyword">import</span> <span class="include">org.junit.Test</span>;
<span class="line-numbers">27</span>
<span class="line-numbers">28</span><span class="keyword">import</span> <span class="include">javax.ws.rs.client.WebTarget</span>;
<span class="line-numbers">29</span><span class="keyword">import</span> <span class="include">org.apache.cxf.jaxrs.provider.jsrjsonp.JsrJsonpProvider</span>;
<span class="line-numbers">30</span>
<span class="line-numbers">31</span><span class="directive">public</span> <span class="type">class</span> <span class="class">SystemEndpointTest</span> {
<span class="line-numbers">32</span>
<span class="line-numbers">33</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> url;
<span class="line-numbers">34</span>
<span class="line-numbers">35</span>    <span class="directive">private</span> Client client;
<span class="line-numbers">36</span>    <span class="directive">private</span> Response response;
<span class="line-numbers">37</span>
<span class="line-numbers">38</span>    <span class="annotation">@BeforeClass</span>
<span class="line-numbers">39</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> oneTimeSetup() {
<span class="line-numbers">40</span>        <span class="predefined-type">String</span> port = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">sys.http.port</span><span class="delimiter">"</span></span>);
<span class="line-numbers">41</span>        url = <span class="string"><span class="delimiter">"</span><span class="content">http://localhost:</span><span class="delimiter">"</span></span> + port + <span class="string"><span class="delimiter">"</span><span class="content">/system/properties/</span><span class="delimiter">"</span></span>;
<span class="line-numbers">42</span>    }
<span class="line-numbers">43</span>
<span class="line-numbers">44</span>    <span class="annotation">@Before</span>
<span class="line-numbers">45</span>    <span class="directive">public</span> <span class="type">void</span> setup() {
<span class="line-numbers">46</span>        response = <span class="predefined-constant">null</span>;
<span class="line-numbers">47</span>        client = ClientBuilder.newBuilder()
<span class="line-numbers">48</span>                    .hostnameVerifier(<span class="keyword">new</span> <span class="predefined-type">HostnameVerifier</span>() {
<span class="line-numbers">49</span>                        <span class="directive">public</span> <span class="type">boolean</span> verify(<span class="predefined-type">String</span> hostname, <span class="predefined-type">SSLSession</span> session) {
<span class="line-numbers">50</span>                            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
<span class="line-numbers">51</span>                        }
<span class="line-numbers">52</span>                    })
<span class="line-numbers">53</span>                    .build();
<span class="line-numbers">54</span>    }
<span class="line-numbers">55</span>
<span class="line-numbers">56</span>    <span class="annotation">@After</span>
<span class="line-numbers">57</span>    <span class="directive">public</span> <span class="type">void</span> teardown() {
<span class="line-numbers">58</span>        client.close();
<span class="line-numbers">59</span>    }
<span class="line-numbers">60</span>
<span class="line-numbers">61</span>    <span class="annotation">@Test</span>
<span class="line-numbers">62</span>    <span class="comment">// tag::testGetProperties[]</span>
<span class="line-numbers">63</span>    <span class="directive">public</span> <span class="type">void</span> testGetProperties() {
<span class="line-numbers">64</span>        Client client = ClientBuilder.newClient();
<span class="line-numbers">65</span>        client.register(JsrJsonpProvider.class);
<span class="line-numbers">66</span>
<span class="line-numbers">67</span>        WebTarget target = client.target(url);
<span class="line-numbers">68</span>        Response response = target.request().get();
<span class="line-numbers">69</span>
<span class="line-numbers">70</span>        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + url, <span class="integer">200</span>, response.getStatus());
<span class="line-numbers">71</span>        response.close();
<span class="line-numbers">72</span>    }
<span class="line-numbers">73</span>    <span class="comment">// end::testGetProperties[]</span>
<span class="line-numbers">74</span>
<span class="line-numbers">75</span>}</code></pre></div></div><div class="paragraph"><p>The <code class="hotspot=testGetProperties file=0">testGetProperties()</code> method checks for a <code>200</code> response code from the <code>system</code> service endpoint.</p></div><div class="listingblock code_command hotspot file=1"><div class="content"> <pre><mark>Create the <code>InventoryEndpointTest</code> class.</mark>
<code>inventory/src/test/java/it/io/openliberty/guides/inventory/InventoryEndpointTest.java</code></pre></div></div><div class="paragraph"><p>InventoryEndpointTest.java</p></div><div class="listingblock code_column hide_tags=copyright"><div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="line-numbers">  1</span><span class="comment">// tag::copyright[]</span>
<span class="line-numbers">  2</span><span class="comment">/*******************************************************************************</span>
<span class="line-numbers">  3</span><span class="comment"> * Copyright (c) 2018, 2019 IBM Corporation and others.</span>
<span class="line-numbers">  4</span><span class="comment"> * All rights reserved. This program and the accompanying materials</span>
<span class="line-numbers">  5</span><span class="comment"> * are made available under the terms of the Eclipse Public License v1.0</span>
<span class="line-numbers">  6</span><span class="comment"> * which accompanies this distribution, and is available at</span>
<span class="line-numbers">  7</span><span class="comment"> * http://www.eclipse.org/legal/epl-v10.html</span>
<span class="line-numbers">  8</span><span class="comment"> *</span>
<span class="line-numbers">  9</span><span class="comment"> * Contributors:</span>
<span class="line-numbers"> 10</span><span class="comment"> *     IBM Corporation - Initial implementation</span>
<span class="line-numbers"> 11</span><span class="comment"> *******************************************************************************/</span>
<span class="line-numbers"> 12</span><span class="comment">// end::copyright[]</span>
<span class="line-numbers"> 13</span><span class="keyword">package</span> <span class="namespace">it.io.openliberty.guides.inventory</span>;
<span class="line-numbers"> 14</span>
<span class="line-numbers"> 15</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertEquals</span>;
<span class="line-numbers"> 16</span><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertTrue</span>;
<span class="line-numbers"> 17</span>
<span class="line-numbers"> 18</span><span class="keyword">import</span> <span class="include">javax.net.ssl.HostnameVerifier</span>;
<span class="line-numbers"> 19</span><span class="keyword">import</span> <span class="include">javax.net.ssl.SSLSession</span>;
<span class="line-numbers"> 20</span><span class="keyword">import</span> <span class="include">javax.ws.rs.client.Client</span>;
<span class="line-numbers"> 21</span><span class="keyword">import</span> <span class="include">javax.ws.rs.client.ClientBuilder</span>;
<span class="line-numbers"> 22</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.Response</span>;
<span class="line-numbers"> 23</span><span class="keyword">import</span> <span class="include">javax.json.JsonObject</span>;
<span class="line-numbers"> 24</span><span class="keyword">import</span> <span class="include">javax.ws.rs.core.MediaType</span>;
<span class="line-numbers"> 25</span>
<span class="line-numbers"> 26</span><span class="keyword">import</span> <span class="include">org.apache.cxf.jaxrs.provider.jsrjsonp.JsrJsonpProvider</span>;
<span class="line-numbers"> 27</span><span class="keyword">import</span> <span class="include">org.junit.After</span>;
<span class="line-numbers"> 28</span><span class="keyword">import</span> <span class="include">org.junit.Before</span>;
<span class="line-numbers"> 29</span><span class="keyword">import</span> <span class="include">org.junit.BeforeClass</span>;
<span class="line-numbers"> 30</span><span class="keyword">import</span> <span class="include">org.junit.Test</span>;
<span class="line-numbers"> 31</span>
<span class="line-numbers"> 32</span><span class="directive">public</span> <span class="type">class</span> <span class="class">InventoryEndpointTest</span> {
<span class="line-numbers"> 33</span>
<span class="line-numbers"> 34</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> invUrl;
<span class="line-numbers"> 35</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> sysUrl;
<span class="line-numbers"> 36</span>    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> systemServiceIp;
<span class="line-numbers"> 37</span>
<span class="line-numbers"> 38</span>    <span class="directive">private</span> Client client;
<span class="line-numbers"> 39</span>    <span class="directive">private</span> Response response;
<span class="line-numbers"> 40</span>
<span class="line-numbers"> 41</span>    <span class="annotation">@BeforeClass</span>
<span class="line-numbers"> 42</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> oneTimeSetup() {
<span class="line-numbers"> 43</span>        <span class="predefined-type">String</span> invServPort = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">inv.http.port</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 44</span>        <span class="predefined-type">String</span> sysServPort = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">sys.http.port</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 45</span>
<span class="line-numbers"> 46</span>        <span class="comment">// tag::systemServiceIp[]</span>
<span class="line-numbers"> 47</span>        systemServiceIp = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">"</span><span class="content">system.ip</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 48</span>        <span class="comment">// end::systemServiceIp[]</span>
<span class="line-numbers"> 49</span>
<span class="line-numbers"> 50</span>        invUrl = <span class="string"><span class="delimiter">"</span><span class="content">http://localhost</span><span class="delimiter">"</span></span> + <span class="string"><span class="delimiter">"</span><span class="content">:</span><span class="delimiter">"</span></span> + invServPort + <span class="string"><span class="delimiter">"</span><span class="content">/inventory/systems/</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 51</span>        sysUrl = <span class="string"><span class="delimiter">"</span><span class="content">http://localhost</span><span class="delimiter">"</span></span> + <span class="string"><span class="delimiter">"</span><span class="content">:</span><span class="delimiter">"</span></span> + sysServPort + <span class="string"><span class="delimiter">"</span><span class="content">/system/properties/</span><span class="delimiter">"</span></span>;
<span class="line-numbers"> 52</span>    }
<span class="line-numbers"> 53</span>
<span class="line-numbers"> 54</span>    <span class="annotation">@Before</span>
<span class="line-numbers"> 55</span>    <span class="directive">public</span> <span class="type">void</span> setup() {
<span class="line-numbers"> 56</span>        response = <span class="predefined-constant">null</span>;
<span class="line-numbers"> 57</span>        client = ClientBuilder.newBuilder()
<span class="line-numbers"> 58</span>                    .hostnameVerifier(<span class="keyword">new</span> <span class="predefined-type">HostnameVerifier</span>() {
<span class="line-numbers"> 59</span>                        <span class="directive">public</span> <span class="type">boolean</span> verify(<span class="predefined-type">String</span> hostname, <span class="predefined-type">SSLSession</span> session) {
<span class="line-numbers"> 60</span>                            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
<span class="line-numbers"> 61</span>                        }
<span class="line-numbers"> 62</span>                    })
<span class="line-numbers"> 63</span>                    .build();
<span class="line-numbers"> 64</span>
<span class="line-numbers"> 65</span>        client.register(JsrJsonpProvider.class);
<span class="line-numbers"> 66</span>        client.target(invUrl + <span class="string"><span class="delimiter">"</span><span class="content">reset</span><span class="delimiter">"</span></span>).request().post(<span class="predefined-constant">null</span>);
<span class="line-numbers"> 67</span>    }
<span class="line-numbers"> 68</span>
<span class="line-numbers"> 69</span>    <span class="annotation">@After</span>
<span class="line-numbers"> 70</span>    <span class="directive">public</span> <span class="type">void</span> teardown() {
<span class="line-numbers"> 71</span>        client.close();
<span class="line-numbers"> 72</span>    }
<span class="line-numbers"> 73</span>
<span class="line-numbers"> 74</span>    <span class="annotation">@Test</span>
<span class="line-numbers"> 75</span>    <span class="directive">public</span> <span class="type">void</span> testSuite() {
<span class="line-numbers"> 76</span>        <span class="local-variable">this</span>.testEmptyInventory();
<span class="line-numbers"> 77</span>        <span class="local-variable">this</span>.testHostRegistration();
<span class="line-numbers"> 78</span>        <span class="local-variable">this</span>.testSystemPropertiesMatch();
<span class="line-numbers"> 79</span>        <span class="local-variable">this</span>.testUnknownHost();
<span class="line-numbers"> 80</span>    }
<span class="line-numbers"> 81</span>
<span class="line-numbers"> 82</span>    <span class="comment">// tag::testEmptyInventory[]</span>
<span class="line-numbers"> 83</span>    <span class="directive">public</span> <span class="type">void</span> testEmptyInventory() {
<span class="line-numbers"> 84</span>        Response response = <span class="local-variable">this</span>.getResponse(invUrl);
<span class="line-numbers"> 85</span>        <span class="local-variable">this</span>.assertResponse(invUrl, response);
<span class="line-numbers"> 86</span>
<span class="line-numbers"> 87</span>        JsonObject obj = response.readEntity(JsonObject.class);
<span class="line-numbers"> 88</span>
<span class="line-numbers"> 89</span>        <span class="type">int</span> expected = <span class="integer">0</span>;
<span class="line-numbers"> 90</span>        <span class="type">int</span> actual = obj.getInt(<span class="string"><span class="delimiter">"</span><span class="content">total</span><span class="delimiter">"</span></span>);
<span class="line-numbers"> 91</span>        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">The inventory should be empty on application start but it wasn't</span><span class="delimiter">"</span></span>,
<span class="line-numbers"> 92</span>                    expected, actual);
<span class="line-numbers"> 93</span>
<span class="line-numbers"> 94</span>        response.close();
<span class="line-numbers"> 95</span>    }
<span class="line-numbers"> 96</span>    <span class="comment">// end::testEmptyInventory[]</span>
<span class="line-numbers"> 97</span>
<span class="line-numbers"> 98</span>    <span class="comment">// tag::testHostRegistration[]</span>
<span class="line-numbers"> 99</span>    <span class="directive">public</span> <span class="type">void</span> testHostRegistration() {
<span class="line-numbers">100</span>        <span class="local-variable">this</span>.visitSystemService();
<span class="line-numbers">101</span>
<span class="line-numbers">102</span>        Response response = <span class="local-variable">this</span>.getResponse(invUrl);
<span class="line-numbers">103</span>        <span class="local-variable">this</span>.assertResponse(invUrl, response);
<span class="line-numbers">104</span>
<span class="line-numbers">105</span>        JsonObject obj = response.readEntity(JsonObject.class);
<span class="line-numbers">106</span>
<span class="line-numbers">107</span>        <span class="type">int</span> expected = <span class="integer">1</span>;
<span class="line-numbers">108</span>        <span class="type">int</span> actual = obj.getInt(<span class="string"><span class="delimiter">"</span><span class="content">total</span><span class="delimiter">"</span></span>);
<span class="line-numbers">109</span>        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">The inventory should have one entry for the system service:</span><span class="delimiter">"</span></span>
<span class="line-numbers">110</span>                                             + systemServiceIp, expected, actual);
<span class="line-numbers">111</span>
<span class="line-numbers">112</span>        <span class="type">boolean</span> serviceExists = obj.getJsonArray(<span class="string"><span class="delimiter">"</span><span class="content">systems</span><span class="delimiter">"</span></span>).getJsonObject(<span class="integer">0</span>)
<span class="line-numbers">113</span>                                    .get(<span class="string"><span class="delimiter">"</span><span class="content">hostname</span><span class="delimiter">"</span></span>).toString()
<span class="line-numbers">114</span>                                    .contains(systemServiceIp);
<span class="line-numbers">115</span>        assertTrue(<span class="string"><span class="delimiter">"</span><span class="content">A host was registered, but it was not </span><span class="delimiter">"</span></span> + systemServiceIp,
<span class="line-numbers">116</span>                serviceExists);
<span class="line-numbers">117</span>
<span class="line-numbers">118</span>        response.close();
<span class="line-numbers">119</span>    }
<span class="line-numbers">120</span>    <span class="comment">// end::testHostRegistration[]</span>
<span class="line-numbers">121</span>
<span class="line-numbers">122</span>    <span class="comment">// tag::testSystemPropertiesMatch[]</span>
<span class="line-numbers">123</span>    <span class="directive">public</span> <span class="type">void</span> testSystemPropertiesMatch() {
<span class="line-numbers">124</span>        Response invResponse = <span class="local-variable">this</span>.getResponse(invUrl);
<span class="line-numbers">125</span>        Response sysResponse = <span class="local-variable">this</span>.getResponse(sysUrl);
<span class="line-numbers">126</span>
<span class="line-numbers">127</span>        <span class="local-variable">this</span>.assertResponse(invUrl, invResponse);
<span class="line-numbers">128</span>        <span class="local-variable">this</span>.assertResponse(sysUrl, sysResponse);
<span class="line-numbers">129</span>
<span class="line-numbers">130</span>        JsonObject jsonFromInventory = (JsonObject) invResponse
<span class="line-numbers">131</span>                                                            .readEntity(JsonObject.class)
<span class="line-numbers">132</span>                                                            .getJsonArray(<span class="string"><span class="delimiter">"</span><span class="content">systems</span><span class="delimiter">"</span></span>)
<span class="line-numbers">133</span>                                                            .getJsonObject(<span class="integer">0</span>)
<span class="line-numbers">134</span>                                                            .get(<span class="string"><span class="delimiter">"</span><span class="content">properties</span><span class="delimiter">"</span></span>);
<span class="line-numbers">135</span>
<span class="line-numbers">136</span>        JsonObject jsonFromSystem = sysResponse.readEntity(JsonObject.class);
<span class="line-numbers">137</span>
<span class="line-numbers">138</span>        <span class="predefined-type">String</span> osNameFromInventory = jsonFromInventory.getString(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>);
<span class="line-numbers">139</span>        <span class="predefined-type">String</span> osNameFromSystem = jsonFromSystem.getString(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>);
<span class="line-numbers">140</span>        <span class="local-variable">this</span>.assertProperty(<span class="string"><span class="delimiter">"</span><span class="content">os.name</span><span class="delimiter">"</span></span>, systemServiceIp, osNameFromSystem,
<span class="line-numbers">141</span>                            osNameFromInventory);
<span class="line-numbers">142</span>
<span class="line-numbers">143</span>        <span class="predefined-type">String</span> userNameFromInventory = jsonFromInventory.getString(<span class="string"><span class="delimiter">"</span><span class="content">user.name</span><span class="delimiter">"</span></span>);
<span class="line-numbers">144</span>        <span class="predefined-type">String</span> userNameFromSystem = jsonFromSystem.getString(<span class="string"><span class="delimiter">"</span><span class="content">user.name</span><span class="delimiter">"</span></span>);
<span class="line-numbers">145</span>        <span class="local-variable">this</span>.assertProperty(<span class="string"><span class="delimiter">"</span><span class="content">user.name</span><span class="delimiter">"</span></span>, systemServiceIp, userNameFromSystem,
<span class="line-numbers">146</span>                            userNameFromInventory);
<span class="line-numbers">147</span>
<span class="line-numbers">148</span>        invResponse.close();
<span class="line-numbers">149</span>        sysResponse.close();
<span class="line-numbers">150</span>    }
<span class="line-numbers">151</span>    <span class="comment">// end::testSystemPropertiesMatch[]</span>
<span class="line-numbers">152</span>
<span class="line-numbers">153</span>    <span class="comment">// tag::testUnknownHost[]</span>
<span class="line-numbers">154</span>    <span class="directive">public</span> <span class="type">void</span> testUnknownHost() {
<span class="line-numbers">155</span>        Response response = <span class="local-variable">this</span>.getResponse(invUrl);
<span class="line-numbers">156</span>        <span class="local-variable">this</span>.assertResponse(invUrl, response);
<span class="line-numbers">157</span>
<span class="line-numbers">158</span>        Response badResponse = client.target(invUrl + <span class="string"><span class="delimiter">"</span><span class="content">badhostname</span><span class="delimiter">"</span></span>)
<span class="line-numbers">159</span>            .request(MediaType.APPLICATION_JSON)
<span class="line-numbers">160</span>            .get();
<span class="line-numbers">161</span>
<span class="line-numbers">162</span>        <span class="predefined-type">String</span> obj = badResponse.readEntity(<span class="predefined-type">String</span>.class);
<span class="line-numbers">163</span>
<span class="line-numbers">164</span>        <span class="type">boolean</span> isError = obj.contains(<span class="string"><span class="delimiter">"</span><span class="content">ERROR</span><span class="delimiter">"</span></span>);
<span class="line-numbers">165</span>        assertTrue(<span class="string"><span class="delimiter">"</span><span class="content">badhostname is not a valid host but it didn't raise an error</span><span class="delimiter">"</span></span>,
<span class="line-numbers">166</span>                isError);
<span class="line-numbers">167</span>
<span class="line-numbers">168</span>        response.close();
<span class="line-numbers">169</span>        badResponse.close();
<span class="line-numbers">170</span>    }
<span class="line-numbers">171</span>    <span class="comment">// end::testUnknownHost[]</span>
<span class="line-numbers">172</span>
<span class="line-numbers">173</span>    <span class="comment">// Returns response information from the specified URL.</span>
<span class="line-numbers">174</span>    <span class="directive">private</span> Response getResponse(<span class="predefined-type">String</span> url) {
<span class="line-numbers">175</span>        <span class="keyword">return</span> client.target(url).request().get();
<span class="line-numbers">176</span>    }
<span class="line-numbers">177</span>
<span class="line-numbers">178</span>    <span class="comment">// Asserts that the given URL has the correct response code of 200.</span>
<span class="line-numbers">179</span>    <span class="directive">private</span> <span class="type">void</span> assertResponse(<span class="predefined-type">String</span> url, Response response) {
<span class="line-numbers">180</span>        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">Incorrect response code from </span><span class="delimiter">"</span></span> + url, <span class="integer">200</span>,
<span class="line-numbers">181</span>                    response.getStatus());
<span class="line-numbers">182</span>    }
<span class="line-numbers">183</span>
<span class="line-numbers">184</span>    <span class="comment">// Asserts that the specified JVM system property is equivalent in both the</span>
<span class="line-numbers">185</span>    <span class="comment">// system and inventory services.</span>
<span class="line-numbers">186</span>    <span class="directive">private</span> <span class="type">void</span> assertProperty(<span class="predefined-type">String</span> propertyName, <span class="predefined-type">String</span> hostname,
<span class="line-numbers">187</span>        <span class="predefined-type">String</span> expected, <span class="predefined-type">String</span> actual) {
<span class="line-numbers">188</span>        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">JVM system property [</span><span class="delimiter">"</span></span> + propertyName + <span class="string"><span class="delimiter">"</span><span class="content">] </span><span class="delimiter">"</span></span>
<span class="line-numbers">189</span>            + <span class="string"><span class="delimiter">"</span><span class="content">in the system service does not match the one stored in </span><span class="delimiter">"</span></span>
<span class="line-numbers">190</span>            + <span class="string"><span class="delimiter">"</span><span class="content">the inventory service for </span><span class="delimiter">"</span></span> + hostname, expected, actual);
<span class="line-numbers">191</span>    }
<span class="line-numbers">192</span>
<span class="line-numbers">193</span>    <span class="comment">// Makes a simple GET request to inventory/localhost.</span>
<span class="line-numbers">194</span>    <span class="directive">private</span> <span class="type">void</span> visitSystemService() {
<span class="line-numbers">195</span>        Response response = <span class="local-variable">this</span>.getResponse(sysUrl);
<span class="line-numbers">196</span>        <span class="local-variable">this</span>.assertResponse(sysUrl, response);
<span class="line-numbers">197</span>        response.close();
<span class="line-numbers">198</span>
<span class="line-numbers">199</span>        Response targetResponse = client
<span class="line-numbers">200</span>            .target(invUrl + systemServiceIp)
<span class="line-numbers">201</span>            .request()
<span class="line-numbers">202</span>            .get();
<span class="line-numbers">203</span>
<span class="line-numbers">204</span>        targetResponse.close();
<span class="line-numbers">205</span>    }
<span class="line-numbers">206</span>
<span class="line-numbers">207</span>}</code></pre></div></div><div class="ulist"><ul><li><p>The <code class="hotspot=testEmptyInventory file=1">testEmptyInventory()</code> method checks that the <code>inventory</code> service has a total of 0 systems before anything is added to it.</p></li><li><p>The <code class="hotspot=testHostRegistration file=1">testHostRegistration()</code> method checks that the <code>system</code> service was added to <code>inventory</code> properly.</p></li><li><p>The <code class="hotspot=testSystemPropertiesMatch file=1">testSystemPropertiesMatch()</code> checks that the <code>system</code> properties match what was added into the <code>inventory</code> service.</p></li><li><p>The <code class="hotspot=testUnknownHost file=1">testUnknownHost()</code> method checks that an error is raised if an unknown host name is being added into the <code>inventory</code> service.</p></li><li><p>The <code class="hotspot=systemServiceIp file=1">systemServiceIp</code> variable has the same value as what you retrieved in the previous section when manually adding the <code>system</code> service into the <code>inventory</code> service. This value of the IP address is passed in when you run the tests.</p></li></ul></div><div class="sect2"><h3 id="running-the-tests">Running the tests</h3><div class="paragraph"><p>Run the Maven <code>verify</code> goal to test the services running in the Docker containers by replacing the <code>[system-ip-address]</code> with the IP address determined in the previous section.</p></div><div class="listingblock command"><div class="content"> <pre class="CodeRay highlight"><code>mvn verify -Ddockerfile.skip=true -Dsystem.ip=[system-ip-address]</code></pre></div></div><div class="paragraph"><p>If the tests pass, you see a similar output as the following:</p></div><div class="listingblock no_copy"><div class="content"> <pre>-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running it.io.openliberty.guides.system.SystemEndpointTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.653 s - in it.io.openliberty.guides.system.SystemEndpointTest

Results:

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running it.io.openliberty.guides.inventory.InventoryEndpointTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.935 s - in it.io.openliberty.guides.inventory.InventoryEndpointTest

Results:

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</pre></div></div><div class="paragraph"><p>When you are finished with the services, run the following commands to stop and remove your containers:</p></div><div class="listingblock command"><div class="content"> <pre class="CodeRay highlight"><code>docker stop inventory system
docker rm inventory system</code></pre></div></div></div></div></div><div class="sect1"><h2 id="great-work-youre-done">Great work! You’re done!</h2><div class="sectionbody"><div class="paragraph"><p>You have just built Docker images and run two microservices on Open Liberty in containers.</p></div></div></div><div class="sect1"><h2 id="guide-attribution">Guide Attribution</h2><div class="sectionbody"><div class="paragraph"><p>Containerizing microservices <span class="licensedClass">by</span> Open Liberty <span class="licensedClass">is licensed under</span> CC BY-ND 4.0</p></div></div></div></div><div id="guide_section_copied_confirmation">Copied to clipboard</div> <img id="copy_to_clipboard" src="https://openliberty.io/img/guides_copy_button.svg" alt="Copy code block" title="Copy code block"></div><div id="code_column" class="position_relative" tabindex="0"><div id="code_column_title_container"><div id="code_column_tabs_container" class="dimmed"><ul id="code_column_tabs" class="nav" role="tablist"></ul></div><div class="copyFileButton" tabindex="0"> <img src="https://openliberty.io/img/guides_copy_button.svg" alt="Copy file contents" title="Copy file contents"></div></div><div id="code_column_content"></div><div id="prereqs_container"><p id="prereqs_title">Prerequisites:</p><div class="prereqs_list"></div></div> <button id="dismiss_button" aria-label="Back to text" tabindex="0">Back to text</button></div></div><div id="end_of_guide"><h2 tabindex="0">Nice work! Where to next?</h2><div id="end_of_guide_left_section"><p id="guide_attribution"></p><h3 id="feedback_rating_question">What did you think of this guide?</h3><div id="feedback_ratings"> <img class="guide_rating" id="extreme_dislike" src="https://openliberty.io/img/1_Extreme_Dislike.png" onclick="$('#dislike_popup').show(),$('.popup_content').focus()" alt="Extreme Dislike" data-guide-rating="1" tabindex="0" aria-label="Rate this guide as extreme dislike"> <img class="guide_rating" id="dislike" src="https://openliberty.io/img/2_Dislike.png" onclick="$('#dislike_popup').show(),$('.popup_content').focus()" alt="Dislike" data-guide-rating="2" tabindex="0" aria-label="Rate this guide as dislike"> <img class="guide_rating" id="like" src="https://openliberty.io/img/3_Like.png" onclick="$('#like_popup').show(),$('.popup_content').focus()" alt="Like" data-guide-rating="3" tabindex="0" aria-label="Rate this guide as like"> <img class="guide_rating" id="extreme_like" src="https://openliberty.io/img/4_Extreme_Like.png" onclick="$('#like_popup').show(),$('.popup_content').focus()" alt="Extreme Like" data-guide-rating="4" tabindex="0" aria-label="Rate this guide as extreme like"></div><div id="like_popup" class="popup"><div class="popup_content" tabindex="0"><p class="popup_title">Thank you for your feedback!</p> <button id="close_button" class="popup_button" onclick="$('#like_popup').hide()">Close</button></div></div><div id="dislike_popup" class="popup"><div class="popup_content" tabindex="0"><p class="popup_title">Thank you for your feedback!</p><p id="open_issue">Would you like to open an issue in GitHub?</p> <a href="https://github.com/OpenLiberty/guide-containerize/issues/new" target="_blank" id="yes_button" class="popup_button" onclick="$('#dislike_popup').hide()" rel="noopener noreferrer">Yes</a> <button id="no_button" class="popup_button" onclick="$('#dislike_popup').hide()">No, thank you</button></div></div><h3 id="improve_guide_feedback">What could make this guide better?</h3><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-containerize/issues">Raise an issue</a> to share feedback</p><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenLiberty/guide-containerize/pulls">Create a pull request</a> to contribute to this guide</p><h3 id="need_help">Need help?</h3><p><a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/open-liberty">Ask a question on Stack Overflow</a></p><h3>Like Open Liberty? Star our repo on GitHub.</h3> <a class="github-button" href="https://github.com/OpenLiberty/open-liberty" data-icon="octicon-star" aria-label="Star OpenLiberty/open-liberty on GitHub" target="_blank" rel="noopener noreferrer">Star</a></div><div id="end_of_guide_right_section"><h3 id="where_to_next">Where to next?</h3><div id="related-guides"><div id="related-guides-cards" class="row"><div class="col-sm-12 col-lg-6"> <a href="https://openliberty.io/guides/docker.html" class="small_guide_item"><div class="guide_title_container"><h3 class="guide_title">Using Docker containers to develop microservices</h3></div> <img class="duration_clock_icon" src="https://openliberty.io/img/guide_duration_clock_icon_small.svg" alt="Duration"> <span class="guide_duration">20 minutes</span> </a></div><div class="col-sm-12 col-lg-6"> <a href="https://openliberty.io/guides/kubernetes-intro.html" class="small_guide_item"><div class="guide_title_container"><h3 class="guide_title">Deploying microservices to Kubernetes</h3></div> <img class="duration_clock_icon" src="https://openliberty.io/img/guide_duration_clock_icon_small.svg" alt="Duration"> <span class="guide_duration">25 minutes</span> </a></div></div></div></div></div></main><footer><div id="footer_gray_background"><div id="footer_top_container" class="footer_container container-fluid"><div id="footer_project_container"> <span id="footer_open_liberty"></span><p id="footer_project">an IBM open source project</p></div><div id="footer_round_links_container"> <a id="footer_github_link" class="footer_round_btn" href="https://github.com/OpenLiberty/" target="_blank" rel="noopener noreferrer" aria-label="Github"></a> <a id="footer_twitter_link" class="footer_round_btn" href="https://twitter.com/OpenLibertyIO" target="_blank" rel="noopener noreferrer" aria-label="Twitter"></a> <a id="footer_stackoverflow_link" class="footer_round_btn" href="https://stackoverflow.com/questions/tagged/open-liberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty questions on Stack Overflow"></a> <a id="footer_groupsio_link" class="footer_round_btn" href="https://groups.io/g/openliberty" target="_blank" rel="noopener noreferrer" aria-label="Open Liberty Groups.io"></a></div></div></div><div id="footer_bottom_container" class="footer_container container-fluid"><div id="footer_bottom_left_section"><p id="footer_copyright">© Copyright IBM Corp. 2017, 2019</p><p class="vertical_bar">|</p> <a id="footer_privacy_policy_link" href="https://www.ibm.com/privacy/" target="_blank" rel="noopener noreferrer" class="left_footer_link">Privacy policy</a><p class="vertical_bar">|</p> <a id="footer_license_link" href="https://github.com/OpenLiberty/open-liberty/blob/master/LICENSE" target="_blank" rel="noopener noreferrer" class="left_footer_link">License</a></div><div id="footer_bottom_right_section"> <a id="footer_docs_link" href="https://openliberty.io/docs" aria-label="Open Liberty Docs" class="right_footer_link blue_link_light_background">Docs</a> <a id="footer_blog_link" href="https://openliberty.io/blog" aria-label="Open Liberty Blogs" class="right_footer_link blue_link_light_background">Blog</a> <a id="footer_support_link" href="https://openliberty.io/support" aria-label="Open Liberty Support" class="right_footer_link blue_link_light_background">Support</a></div></div> </footer><div class="d-none hidden"> <img src="https://openliberty.io/img/Footer_GitCat_Hover.svg" alt="OpenLiberty Github link"> <img src="https://openliberty.io/img/Footer_TwitterBird_Hover.svg" alt="OpenLibertyIO Twitter link"> <img src="https://openliberty.io/img/Footer_StackO_Hover.svg" alt="Open-liberty Stack Overflow link"> <img src="https://openliberty.io/img/Footer_GroupsIO_Hover.svg" alt="Openliberty Groups IO link"></div> <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script><script src="https://openliberty.io/assets/devEnvironment-1534f5b3d86298872bff0c998dc072080c30665ac1e9f1d3087393aeba41be1b.js"></script><script src="https://openliberty.io/assets/guide-utils-1bc9c95c7a39c5aed996a9daa39e02bfe2587ae5cb4e6295e95953f57ab7b24a.js"></script><script src="https://openliberty.io/assets/toc-9f2c0762562ac94cfdc5a228800ba66c04c7b5d7bc6acbf83b1f5b475eaad995.js"></script><script src="https://openliberty.io/assets/guide-608dca3e839e274e1af63578c774065d6357bd7e40e8c4f939821395b2c3d669.js"></script><script src="https://openliberty.io/assets/guide-multipane-b593df5e24233d10a69719b81b4ed58aa8e285752947c5ca52a04b26f8d77d5b.js"></script></body></html>